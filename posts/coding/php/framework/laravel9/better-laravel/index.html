<!doctype html><html class="not-ready text-sm lg:text-base" style=--bg:#fbfbfb lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Better-Laravel - Yesccx Blog</title><meta name=theme-color><meta name=description content="Better-Laravel 基于PHP8.1，适用于Laravel框架进行快速开发的工具包
目录 目录 安装 运行环境 通过Composer引入依赖包 初始化安装 定义异常处理 基础功能 路由 模块路由 命令行 迁移文件转换为DDL语句 Laravel部署优化 异常处理 Traits InstanceMake Class::make Class::resolve Class::instance InitializeTraits BaseService 辅助方法 dumps dds explode_str_array 数据库 分页查询 普通分页查询 简单分页查询 自定义分页数据 空分页 Builder查询 customPaginate customSimplePaginate whereLike whenLike whereToday whereThisDay whereInDay whereThisWeek whereThisMonth whereInMonth whereThisYear whereInYear whereGtDate whereGteDate whereLtDate whereLteDate whereBetweenDate 非严格格式查询 HTTP 请求响应(Responser) responseSuccess responseError responseData responseException 控制器基类 接口响应(Response) 入参类型转换(TypeTransfrom) 表单验证 表单验证基类 验证场景 验证规则 ArrayIdsRule Base64Rule IdCardRule LandlinePhoneRule PhoneRule StringArrayIdsRule SubManyRequestRule SubRequestRule 配置项 date_format http."><meta name=author content="Yesccx"><link rel="preload stylesheet" as=style href=https://blog.yes-api.com/main.min.css><link rel=preload as=image href=https://blog.yes-api.com/theme.png><link rel=preload as=image href=https://blog.yes-api.com/avator.jpg><link rel=preload as=image href=https://blog.yes-api.com/github.svg><link rel=preload as=image href=https://blog.yes-api.com/rss.svg><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<link rel=icon href=https://blog.yes-api.com/favicon.ico><link rel=apple-touch-icon href=https://blog.yes-api.com/apple-touch-icon.png><meta name=generator content="Hugo 0.111.3"><meta property="og:title" content="Better-Laravel"><meta property="og:description" content="Better-Laravel 基于PHP8.1，适用于Laravel框架进行快速开发的工具包
目录 目录 安装 运行环境 通过Composer引入依赖包 初始化安装 定义异常处理 基础功能 路由 模块路由 命令行 迁移文件转换为DDL语句 Laravel部署优化 异常处理 Traits InstanceMake Class::make Class::resolve Class::instance InitializeTraits BaseService 辅助方法 dumps dds explode_str_array 数据库 分页查询 普通分页查询 简单分页查询 自定义分页数据 空分页 Builder查询 customPaginate customSimplePaginate whereLike whenLike whereToday whereThisDay whereInDay whereThisWeek whereThisMonth whereInMonth whereThisYear whereInYear whereGtDate whereGteDate whereLtDate whereLteDate whereBetweenDate 非严格格式查询 HTTP 请求响应(Responser) responseSuccess responseError responseData responseException 控制器基类 接口响应(Response) 入参类型转换(TypeTransfrom) 表单验证 表单验证基类 验证场景 验证规则 ArrayIdsRule Base64Rule IdCardRule LandlinePhoneRule PhoneRule StringArrayIdsRule SubManyRequestRule SubRequestRule 配置项 date_format http."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.yes-api.com/posts/coding/php/framework/laravel9/better-laravel/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-03T15:12:09+00:00"><meta property="article:modified_time" content="2022-07-03T15:12:09+00:00"><meta itemprop=name content="Better-Laravel"><meta itemprop=description content="Better-Laravel 基于PHP8.1，适用于Laravel框架进行快速开发的工具包
目录 目录 安装 运行环境 通过Composer引入依赖包 初始化安装 定义异常处理 基础功能 路由 模块路由 命令行 迁移文件转换为DDL语句 Laravel部署优化 异常处理 Traits InstanceMake Class::make Class::resolve Class::instance InitializeTraits BaseService 辅助方法 dumps dds explode_str_array 数据库 分页查询 普通分页查询 简单分页查询 自定义分页数据 空分页 Builder查询 customPaginate customSimplePaginate whereLike whenLike whereToday whereThisDay whereInDay whereThisWeek whereThisMonth whereInMonth whereThisYear whereInYear whereGtDate whereGteDate whereLtDate whereLteDate whereBetweenDate 非严格格式查询 HTTP 请求响应(Responser) responseSuccess responseError responseData responseException 控制器基类 接口响应(Response) 入参类型转换(TypeTransfrom) 表单验证 表单验证基类 验证场景 验证规则 ArrayIdsRule Base64Rule IdCardRule LandlinePhoneRule PhoneRule StringArrayIdsRule SubManyRequestRule SubRequestRule 配置项 date_format http."><meta itemprop=datePublished content="2022-07-03T15:12:09+00:00"><meta itemprop=dateModified content="2022-07-03T15:12:09+00:00"><meta itemprop=wordCount content="3204"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Better-Laravel"><meta name=twitter:description content="Better-Laravel 基于PHP8.1，适用于Laravel框架进行快速开发的工具包
目录 目录 安装 运行环境 通过Composer引入依赖包 初始化安装 定义异常处理 基础功能 路由 模块路由 命令行 迁移文件转换为DDL语句 Laravel部署优化 异常处理 Traits InstanceMake Class::make Class::resolve Class::instance InitializeTraits BaseService 辅助方法 dumps dds explode_str_array 数据库 分页查询 普通分页查询 简单分页查询 自定义分页数据 空分页 Builder查询 customPaginate customSimplePaginate whereLike whenLike whereToday whereThisDay whereInDay whereThisWeek whereThisMonth whereInMonth whereThisYear whereInYear whereGtDate whereGteDate whereLtDate whereLteDate whereBetweenDate 非严格格式查询 HTTP 请求响应(Responser) responseSuccess responseError responseData responseException 控制器基类 接口响应(Response) 入参类型转换(TypeTransfrom) 表单验证 表单验证基类 验证场景 验证规则 ArrayIdsRule Base64Rule IdCardRule LandlinePhoneRule PhoneRule StringArrayIdsRule SubManyRequestRule SubRequestRule 配置项 date_format http."></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold" href=https://blog.yes-api.com/>Yesccx Blog</a><div class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#fbfbfb".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6"><a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/tags/>Tags</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/archives/>Archives</a></nav><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"><a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/yesccx target=_blank rel=me>github</a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./rss.svg) href=https://blog.yes-api.com/index.xml target=_blank rel=alternate>rss</a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pb-24 pt-16 dark:prose-invert"><article><header class=mb-20><h1 class="!my-0 pb-2.5">Better-Laravel</h1><div class="text-sm opacity-60"><time>2022年07月03日 15:12</time></div></header><section><div class=toc><details open><summary>TOC</summary><nav id=TableOfContents><ul><li><a href=#运行环境>运行环境</a></li><li><a href=#通过composer引入依赖包>通过Composer引入依赖包</a></li><li><a href=#初始化安装>初始化安装</a></li><li><a href=#定义异常处理>定义异常处理</a></li></ul><ul><li><a href=#路由>路由</a><ul><li><a href=#模块路由>模块路由</a></li></ul></li><li><a href=#命令行>命令行</a><ul><li><a href=#迁移文件转换为ddl语句>迁移文件转换为DDL语句</a></li><li><a href=#laravel部署优化>Laravel部署优化</a></li></ul></li><li><a href=#异常处理>异常处理</a></li><li><a href=#traits>Traits</a><ul><li><a href=#instancemake>InstanceMake</a></li><li><a href=#initializetraits>InitializeTraits</a></li></ul></li><li><a href=#baseservice>BaseService</a></li><li><a href=#辅助方法>辅助方法</a><ul><li><a href=#dumps>dumps</a></li><li><a href=#dds>dds</a></li><li><a href=#explode_str_array>explode_str_array</a></li></ul></li></ul><ul><li><a href=#分页查询>分页查询</a><ul><li><a href=#普通分页查询>普通分页查询</a></li><li><a href=#简单分页查询>简单分页查询</a></li><li><a href=#自定义分页数据>自定义分页数据</a></li><li><a href=#空分页>空分页</a></li></ul></li><li><a href=#builder查询>Builder查询</a><ul><li><a href=#custompaginate>customPaginate</a></li><li><a href=#customsimplepaginate>customSimplePaginate</a></li><li><a href=#wherelike>whereLike</a></li><li><a href=#whenlike>whenLike</a></li><li><a href=#wheretoday>whereToday</a></li><li><a href=#wherethisday>whereThisDay</a></li><li><a href=#whereinday>whereInDay</a></li><li><a href=#wherethisweek>whereThisWeek</a></li><li><a href=#wherethismonth>whereThisMonth</a></li><li><a href=#whereinmonth>whereInMonth</a></li><li><a href=#wherethisyear>whereThisYear</a></li><li><a href=#whereinyear>whereInYear</a></li><li><a href=#wheregtdate>whereGtDate</a></li><li><a href=#wheregtedate>whereGteDate</a></li><li><a href=#whereltdate>whereLtDate</a></li><li><a href=#whereltedate>whereLteDate</a></li><li><a href=#wherebetweendate>whereBetweenDate</a></li><li><a href=#非严格格式查询>非严格格式查询</a></li></ul></li></ul><ul><li><a href=#请求响应responser>请求响应(Responser)</a><ul><li><a href=#responsesuccess>responseSuccess</a></li><li><a href=#responseerror>responseError</a></li><li><a href=#responsedata>responseData</a></li><li><a href=#responseexception>responseException</a></li></ul></li><li><a href=#控制器基类>控制器基类</a><ul><li><a href=#接口响应response>接口响应(Response)</a></li><li><a href=#入参类型转换typetransfrom>入参类型转换(TypeTransfrom)</a></li></ul></li><li><a href=#表单验证>表单验证</a><ul><li><a href=#表单验证基类>表单验证基类</a></li><li><a href=#验证场景>验证场景</a></li></ul></li><li><a href=#验证规则>验证规则</a><ul><li><a href=#arrayidsrule>ArrayIdsRule</a></li><li><a href=#base64rule>Base64Rule</a></li><li><a href=#idcardrule>IdCardRule</a></li><li><a href=#landlinephonerule>LandlinePhoneRule</a></li><li><a href=#phonerule>PhoneRule</a></li><li><a href=#stringarrayidsrule>StringArrayIdsRule</a></li><li><a href=#submanyrequestrule>SubManyRequestRule</a></li><li><a href=#subrequestrule>SubRequestRule</a></li></ul></li></ul><ul><li><a href=#date_format>date_format</a></li><li><a href=#httproute_scanning>http.route_scanning</a></li><li><a href=#httpmessage_body_map>http.message_body_map</a></li></ul></nav></details></div><h1 align=center>Better-Laravel</h1><p align=center>基于PHP8.1，适用于Laravel框架进行快速开发的工具包</p><p align=center><a href=https://github.com/yesccx/better-laravel><img alt="For Laravel 5" src=https://img.shields.io/badge/laravel-9.*-green.svg style=max-width:100%></a>
<a href=https://packagist.org/packages/yesccx/better-laravel><img alt="Latest Stable Version" src=https://img.shields.io/packagist/v/yesccx/better-laravel.svg style=max-width:100%></a>
<a href=https://packagist.org/packages/yesccx/better-laravel><img alt="Latest Unstable Version" src=https://img.shields.io/packagist/vpre/yesccx/better-laravel.svg style=max-width:100%></a>
<a href=https://packagist.org/packages/yesccx/better-laravel><img alt="Total Downloads" src="https://img.shields.io/packagist/dt/yesccx/better-laravel.svg?maxAge=2592000" style=max-width:100%></a>
<a href=https://packagist.org/packages/yesccx/better-laravel><img alt=License src="https://img.shields.io/packagist/l/yesccx/better-laravel.svg?maxAge=2592000" style=max-width:100%></a></p><h1 id=目录>目录</h1><ul><li><a href=#%E7%9B%AE%E5%BD%95>目录</a></li><li><a href=#%E5%AE%89%E8%A3%85>安装</a><ul><li><a href=#%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83>运行环境</a></li><li><a href=#%E9%80%9A%E8%BF%87composer%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96%E5%8C%85>通过Composer引入依赖包</a></li><li><a href=#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85>初始化安装</a></li><li><a href=#%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86>定义异常处理</a></li></ul></li><li><a href=#%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD>基础功能</a><ul><li><a href=#%E8%B7%AF%E7%94%B1>路由</a><ul><li><a href=#%E6%A8%A1%E5%9D%97%E8%B7%AF%E7%94%B1>模块路由</a></li></ul></li><li><a href=#%E5%91%BD%E4%BB%A4%E8%A1%8C>命令行</a><ul><li><a href=#%E8%BF%81%E7%A7%BB%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAddl%E8%AF%AD%E5%8F%A5>迁移文件转换为DDL语句</a></li><li><a href=#laravel%E9%83%A8%E7%BD%B2%E4%BC%98%E5%8C%96>Laravel部署优化</a></li></ul></li><li><a href=#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86>异常处理</a></li><li><a href=#traits>Traits</a><ul><li><a href=#instancemake>InstanceMake</a><ul><li><a href=#classmake>Class::make</a></li><li><a href=#classresolve>Class::resolve</a></li><li><a href=#classinstance>Class::instance</a></li></ul></li><li><a href=#initializetraits>InitializeTraits</a></li></ul></li><li><a href=#baseservice>BaseService</a></li><li><a href=#%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95>辅助方法</a><ul><li><a href=#dumps>dumps</a></li><li><a href=#dds>dds</a></li><li><a href=#explode_str_array>explode_str_array</a></li></ul></li></ul></li><li><a href=#%E6%95%B0%E6%8D%AE%E5%BA%93>数据库</a><ul><li><a href=#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2>分页查询</a><ul><li><a href=#%E6%99%AE%E9%80%9A%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2>普通分页查询</a></li><li><a href=#%E7%AE%80%E5%8D%95%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2>简单分页查询</a></li><li><a href=#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E6%95%B0%E6%8D%AE>自定义分页数据</a></li><li><a href=#%E7%A9%BA%E5%88%86%E9%A1%B5>空分页</a></li></ul></li><li><a href=#builder%E6%9F%A5%E8%AF%A2>Builder查询</a><ul><li><a href=#custompaginate>customPaginate</a></li><li><a href=#customsimplepaginate>customSimplePaginate</a></li><li><a href=#wherelike>whereLike</a></li><li><a href=#whenlike>whenLike</a></li><li><a href=#wheretoday>whereToday</a></li><li><a href=#wherethisday>whereThisDay</a></li><li><a href=#whereinday>whereInDay</a></li><li><a href=#wherethisweek>whereThisWeek</a></li><li><a href=#wherethismonth>whereThisMonth</a></li><li><a href=#whereinmonth>whereInMonth</a></li><li><a href=#wherethisyear>whereThisYear</a></li><li><a href=#whereinyear>whereInYear</a></li><li><a href=#wheregtdate>whereGtDate</a></li><li><a href=#wheregtedate>whereGteDate</a></li><li><a href=#whereltdate>whereLtDate</a></li><li><a href=#whereltedate>whereLteDate</a></li><li><a href=#wherebetweendate>whereBetweenDate</a></li><li><a href=#%E9%9D%9E%E4%B8%A5%E6%A0%BC%E6%A0%BC%E5%BC%8F%E6%9F%A5%E8%AF%A2>非严格格式查询</a></li></ul></li></ul></li><li><a href=#http>HTTP</a><ul><li><a href=#%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94responser>请求响应(Responser)</a><ul><li><a href=#responsesuccess>responseSuccess</a></li><li><a href=#responseerror>responseError</a></li><li><a href=#responsedata>responseData</a></li><li><a href=#responseexception>responseException</a></li></ul></li><li><a href=#%E6%8E%A7%E5%88%B6%E5%99%A8%E5%9F%BA%E7%B1%BB>控制器基类</a><ul><li><a href=#%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94response>接口响应(Response)</a></li><li><a href=#%E5%85%A5%E5%8F%82%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2typetransfrom>入参类型转换(TypeTransfrom)</a></li></ul></li><li><a href=#%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81>表单验证</a><ul><li><a href=#%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81%E5%9F%BA%E7%B1%BB>表单验证基类</a></li><li><a href=#%E9%AA%8C%E8%AF%81%E5%9C%BA%E6%99%AF>验证场景</a></li></ul></li><li><a href=#%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99>验证规则</a><ul><li><a href=#arrayidsrule>ArrayIdsRule</a></li><li><a href=#base64rule>Base64Rule</a></li><li><a href=#idcardrule>IdCardRule</a></li><li><a href=#landlinephonerule>LandlinePhoneRule</a></li><li><a href=#phonerule>PhoneRule</a></li><li><a href=#stringarrayidsrule>StringArrayIdsRule</a></li><li><a href=#submanyrequestrule>SubManyRequestRule</a></li><li><a href=#subrequestrule>SubRequestRule</a></li></ul></li></ul></li><li><a href=#%E9%85%8D%E7%BD%AE%E9%A1%B9>配置项</a><ul><li><a href=#date_format>date_format</a></li><li><a href=#httproute_scanning>http.route_scanning</a></li><li><a href=#httpmessage_body_map>http.message_body_map</a></li></ul></li><li><a href=#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE>使用建议</a></li><li><a href=#license>License</a></li></ul><h1 id=安装>安装</h1><h2 id=运行环境>运行环境</h2><div class=table-wrapper><table><thead><tr><th>运行环境要求</th></tr></thead><tbody><tr><td>PHP ^8.1.0</td></tr><tr><td>Laravel Framework ^9.0</td></tr></tbody></table></div><h2 id=通过composer引入依赖包>通过Composer引入依赖包</h2><p>通过终端进入项目根目录，执行以下命令引入依赖包：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>&gt; composer require yesccx/better-laravel:1.x
</span></span></code></pre></div><h2 id=初始化安装>初始化安装</h2><p><code>Better-Laravel</code> 支持一系列配置参数，如 <code>默认时间格式</code> 等，更多配置项参考<a href=#%E9%85%8D%E7%BD%AE%E9%A1%B9>配置项</a>章节，通过以下命令进行初始化安装操作：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>&gt; php artisan better-laravel:install
</span></span></code></pre></div><blockquote><p>初始化之后会默认引入使用服务提供者 <code>App\Providers\BetterLaravelProvider</code>，后续可在该提供者内部做更多的定制化处理。</p></blockquote><h2 id=定义异常处理>定义异常处理</h2><p>当需要使用 <code>Better-Laravel</code> 中的异常处理逻辑，仅需在 <code>\App\Exceptions\Handler@register</code> 中调用 <code>\Yesccx\BetterLaravel\Exceptions\ExceptionHandlerManager::register</code> 即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>namespace</span> <span class=nx>App\Exceptions</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Foundation\Exceptions\Handler</span> <span class=k>as</span> <span class=nx>ExceptionHandler</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>use</span> <span class=nx>Yesccx\BetterLaravel\Exceptions\ExceptionHandlerManager</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=k>class</span> <span class=nc>Handler</span> <span class=k>extends</span> <span class=nx>ExceptionHandler</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=sd>     * Register the exception handling callbacks for the application.
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>register</span><span class=p>()</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=nx>ExceptionHandlerManager</span><span class=o>::</span><span class=na>register</span><span class=p>(</span><span class=nv>$this</span><span class=p>);</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>        <span class=c1>// Do something....
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>更多详情可以参考 <a href=#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86>异常处理</a> 章节</p></blockquote><h1 id=基础功能>基础功能</h1><h2 id=路由>路由</h2><h3 id=模块路由>模块路由</h3><p>通常情况下，我们会将路由定义在 <code>routes/api.php</code> 文件内。然而随着项目的不断迭代，定义的路由也会越来越多。为了更好地管理这些路由，我们可以选择将它们按照功能模块拆分，并单独定义在不同的路由文件中。
例如，我们可以将用户相关的路由定义在 <code>routes/modules/user.php</code> 文件中，将订单相关的路由定义在 <code>routes/modules/order.php</code> 中等。这种做法可以有效减少单个路由文件内的接口数量，以清晰地管理项目的接口。</p><p>为了引入这些路由文件，我们可以使用 <code>Better-Laravel</code> 包中提供的 <code>模块路由</code> 快速注册功能。只需将路由文件定义在 <code>routes/modules</code> 目录下，其中的路由都将被自动扫描并注册。通过使用 <code>Better-Laravel</code> 提供的快速注册功能，我们可以轻松管理和组织各个模块的路由，使代码更加清晰易懂。</p><p>以下是示例参考：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1>// routes/modules/user.php
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Route</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>group</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=s1>&#39;prefix&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;user&#39;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=p>],</span> <span class=k>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=c1>// Create user
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;create&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>\App\Http\Controller\UserController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;create&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=c1>// Get userinfo
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;info&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>\App\Http\Controller\UserController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;info&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1>// routes/modules/content.php
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Route</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>group</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=s1>&#39;prefix&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;content&#39;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=p>],</span> <span class=k>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=c1>// Get list
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;list&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>\App\Http\Controller\ContentController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;list&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=c1>// Get info
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;info&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>\App\Http\Controller\ContentController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;info&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>默认情况下，<code>Better-Laravel</code> 仅会扫描 <code>routes/modules</code> 目录下的路由文件，并为这些路由指定 <code>prefix</code> 为 <code>api</code>、<code>middleware</code> 为 <code>api</code> 的参数。如果需要，可以通过配置 <code>better-laravel.http.scanning_route</code> 调整相关参数或定义额外的扫描路径。通过自定义配置，我们可以更灵活地管理和组织不同模块的路由，并且能够快速扩展和适应不同项目的需求。</p><blockquote><p>通过这种方式定义的路由，不会影响 <code>route:cache</code> 缓存生成。</p></blockquote><h2 id=命令行>命令行</h2><h3 id=迁移文件转换为ddl语句>迁移文件转换为DDL语句</h3><p><code>Laravel</code> 允许我们利用 <code>迁移文件</code> 进行表结构调整，但有时候可能不方便直连数据库执行迁移文件，又或者想备份迁移文件所执行的具体 <code>DDL</code> 语句，此时可以借助 <code>migrate:to-sql</code> 脚本将 <code>迁移文件</code> 转换为 <code>DDL</code> 语句。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl>&gt; php artisan migrate:to-sql --path<span class=o>=</span>database/migrations/2023_03_15_172792_create_users_table
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># --------------------------------------------------</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1># -- Input: database/migrations/2023_03_15_172792_create_users_table.php / up</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1># -- Datetime: 2023-04-03 10:18:14</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1># -- Total: 1</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1># --------------------------------------------------</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1># -- Migrate：2023_03_15_172792_create_users_table.php</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># create table `users` (`id` bigint unsigned not null auto_increment primary key comment &#39;自增id&#39;) default character set utf8mb4 collate &#39;utf8mb4_unicode_ci&#39;;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1># ALTER TABLE `users` comment &#39;用户表&#39;;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1># --------------------------------------------------</span>
</span></span></code></pre></div><p><code>path</code> 选项可接收模糊关键字，如想将 <code>2023-04-03</code> 当天创建的迁移文件转换，选项参数指定为 <code>--path=2023_03_15</code> 即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=c1># 处理迁移文件名中含有关键字&#39;2023_03_15&#39;的迁移文件</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>&gt; php artisan migrate:to-sql --path<span class=o>=</span>2023_03_15
</span></span><span class=line><span class=ln>3</span><span class=cl>
</span></span><span class=line><span class=ln>4</span><span class=cl>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=c1># 处理迁移文件名中含有关键字&#39;user&#39;的迁移文件</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>&gt; php artisan migrate:to-sql --path<span class=o>=</span>user
</span></span></code></pre></div><p>另外可以通过 <code>type</code> 选项调整默认处理的迁移文件逻辑，<code>type</code> 选项可接收值 <code>up</code> / <code>down</code>，分别对应迁移文件中的 <code>up方法</code> / <code>down方法</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>&gt; php artisan migrate:to-sql --path<span class=o>=</span>2023_03_15 --type<span class=o>=</span>down
</span></span></code></pre></div><p>默认情况下会将转换后的结果直接输出到终端，我们可以通过 <code>Linux</code> 中的输出重定向功能将结果保存至指定文件中。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>&gt; php artisan migrate:to-sql --path<span class=o>=</span>2023_03_15 &gt;&gt; migrate.sql
</span></span></code></pre></div><h3 id=laravel部署优化>Laravel部署优化</h3><p>当项目部署至生产环境后，为了提升应用的性能，我们可以利用 <code>Laravel</code> 中提供的一系列命令进行配置优化，例如 <code>route:cache</code>、<code>config:cache</code> 等（具体参考 <a href=https://learnku.com/docs/laravel/9.x/deployment/12204#a9f94d>Laravel部署章节</a>）。<code>Better-Laravel</code> 中提供了 <code>optimize:all</code> 脚本，可以在生产环境中快速优化整个应用程序，该脚本会执行一系列优化操作，以提高应用程序的性能和响应速度。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>&gt; php artisan optimize:all --force
</span></span></code></pre></div><p>上述脚本会依次执行：</p><ul><li><code>event:cache</code></li><li><code>view:cache</code></li><li><code>route:cache</code></li><li><code>config:cache</code></li><li><code>composer dump-autoload --optimize</code></li></ul><blockquote><p>如果项目是运行在 <code>Docker</code> 容器内的，可以将脚本定义到入口命令 <code>CMD</code> 中执行。这样做的好处在于，每次容器启动时都会自动执行优化脚本。</p></blockquote><h2 id=异常处理>异常处理</h2><p>在 <code>Better-Laravel</code> 中对异常类进行了统一的捕获处理，对异常信息进行脱敏后再以标准的接口响应方式响应异常信息(<a href=#%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94(Responser)><code>Responser</code></a>)，从而提高了应用的安全性和规范性。</p><p>如果想使用 <code>Better-Laravel</code> 的异常处理，只需要在 <code>\App\Exceptions\Handler@register</code> 中调用 <code>\Yesccx\BetterLaravel\Exceptions\ExceptionHandlerManager::register</code> 即可，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>namespace</span> <span class=nx>App\Exceptions</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Foundation\Exceptions\Handler</span> <span class=k>as</span> <span class=nx>ExceptionHandler</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>use</span> <span class=nx>Yesccx\BetterLaravel\Exceptions\ExceptionHandlerManager</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=k>class</span> <span class=nc>Handler</span> <span class=k>extends</span> <span class=nx>ExceptionHandler</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=sd>     * Register the exception handling callbacks for the application.
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>register</span><span class=p>()</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=nx>ExceptionHandlerManager</span><span class=o>::</span><span class=na>register</span><span class=p>(</span><span class=nv>$this</span><span class=p>);</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>其中捕获的 <code>Laravel内部异常</code> 有：</p><ul><li><code>NotFoundHttpException</code>：请求的接口地址不存在异常；</li><li><code>MethodNotAllowedHttpException</code>：请求方法不允许异常；</li><li><code>ModelNotFoundException</code>：通过 <code>firstOrFail</code> 查询异常；</li><li><code>ValidationException</code>：表单验证失败异常。</li></ul><p>对于 <code>NotFoundHttpException</code>、<code>MethodNotAllowedHttpException</code> 及 <code>ModelNotFoundException</code> 这类异常可以理解为应用 <code>missing</code> 异常，因此不会直接暴露异常原因，而是提供了默认的提示文案"内容不存在"。同时，我们还提供了 <code>better-laravel.exception.missing_summary</code> 配置来自定义提示文案。 对于 <code>ValidationException</code> 异常，为表单验证失败时的异常，我们会将其异常原因指定为验证规则的具体错误信息。</p><p>其中捕获的 <code>Better-Laravel</code> 内部业务异常有：</p><ul><li><code>ApiService</code>：接口异常或业务异常</li><li><code>ServiceService</code>：服务层异常</li></ul><p>对于这些异常，我们会直接返回异常原因，并且可以通过开启 <code>better-laravel.exception.use_exception_code</code> 使用 <code>异常码</code> 的功能，将<code>异常码</code> 作为接口响应体中的 <code>code</code> 码。</p><p>除此之外的异常都被统称为 <code>其它未知异常</code>，因为来源不明确，为了防止意外暴露敏感信息，我们同样的会使用统一的提示文案 &ldquo;系统错误&rdquo;，此外我们还提供了 <code>better-laravel.exception.ignored_summary</code> 配置来自定义提示文案。在开发阶段，您可以通过开启 DEBUG 模式( <code>APP_DEBUG=true</code> ) 或者指定 <code>better-laravel.exception.ignore_tracks</code> 为 <code>false</code>，来显示 <code>其它未知异常</code> 的异常栈详情。</p><p>但某些时候我们会自定义业务异常类，如果希望在捕获到这类异常后，将异常原因直接返回给客户端，我们可以通过以下方式进行：</p><ul><li>方式一：业务异常类实现 <code>Yesccx\BetterLaravel\Contracts\WithExceptionOptions</code> 接口，并在 <code>exceptionOptions</code> 方法中指定不忽略异常栈详情 <code>["ignore_tracts" => false]</code> ；</li><li>方式二：将自定义异常类名传递给 <code>ExceptionHandlerManager::register</code> 方法的第二个参数 <code>immediateExceptions</code>。</li></ul><blockquote><p>默认情况下会自动记录异常原因至日志文件中。</p></blockquote><h2 id=traits>Traits</h2><h3 id=instancemake>InstanceMake</h3><p>为类引入 <code>Yesccx\BetterLaravel\Traits\InstanceMake</code> Trait后，赋于类快速实例化的能力。<code>InstanceMake</code> 中包含三种实例化类的方式。</p><h4 id=classmake>Class::make</h4><p>非单例/支持构建函数传参/不支持构造函数依赖注入:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=k>class</span> <span class=nc>UserService</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=k>use</span> <span class=nx>InstanceMake</span><span class=p>;</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>        <span class=k>public</span> <span class=nx>int</span> <span class=nv>$id</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>    <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=nx>UserService</span><span class=o>::</span><span class=na>make</span><span class=p>([</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>]);</span>
</span></span></code></pre></div><h4 id=classresolve>Class::resolve</h4><p>非单例/不支持构建函数传参/支持构造函数依赖注入:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=k>class</span> <span class=nc>UserService</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=k>use</span> <span class=nx>InstanceMake</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>        <span class=k>public</span> <span class=nx>UserModel</span> <span class=nv>$model</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nv>$user</span> <span class=o>=</span> <span class=nx>UserService</span><span class=o>::</span><span class=na>resolve</span><span class=p>();</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>model</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>([</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>]);</span>
</span></span></code></pre></div><h4 id=classinstance>Class::instance</h4><p>单例/不支持构建函数传参/支持构造函数依赖注入:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=k>class</span> <span class=nc>UserService</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=k>use</span> <span class=nx>InstanceMake</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>        <span class=k>public</span> <span class=nx>UserModel</span> <span class=nv>$model</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nv>$user</span> <span class=o>=</span> <span class=nx>UserService</span><span class=o>::</span><span class=na>resolve</span><span class=p>();</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>model</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>([</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1>// 再次调用时不会重复实例化类
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span><span class=nx>UserService</span><span class=o>::</span><span class=na>resolve</span><span class=p>();</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1>// 指定强制重新实例化类
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1></span><span class=nx>UserService</span><span class=o>::</span><span class=na>resolve</span><span class=p>(</span><span class=nx>force</span><span class=o>:</span> <span class=k>true</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=initializetraits>InitializeTraits</h3><p>在 <code>PHP</code> 中，我们可以使用 <code>Trait</code> 来扩展类的功能。然而，与类不同的是，<code>Trait</code> 没有类似构造函数的初始化方法，这使得在使用 <code>Trait</code> 时可能会面临一些困难。为了解决这个问题，我们可以利用 <code>Yesccx\BetterLaravel\Traits\InitializeTraits</code> 这个工具包，将初始化能力引入到 <code>Trait</code> 中。这样，我们就可以在使用 <code>Trait</code> 时轻松地进行初始化操作，提高代码的可读性和可维护性。</p><p>当我们在目标类上引入了 <code>InitializeTraits</code> 后，这个类上的其他 <code>Trait</code> 就可以以 <code>initialize + trait名称</code> 的方式来定义一个初始化方法。例如，如果有一个名为 <code>RecordLog</code> 的 <code>Trait</code>，那么其对应的初始化方法就是 <code>initializeRecordLog</code> ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>use</span> <span class=nx>Yesccx\BetterLaravel\Traits\InitializeTraits</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>trait</span> <span class=nx>RecordLog</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=k>protected</span> <span class=nx>\Illuminate\Log\Logger</span> <span class=nv>$logger</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>initializeRecordLog</span><span class=p>()</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>logger</span> <span class=o>=</span> <span class=nx>app</span><span class=p>(</span><span class=nx>\Illuminate\Log\Logger</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>record</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$message</span><span class=p>)</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>logger</span><span class=o>-&gt;</span><span class=na>info</span><span class=p>(</span><span class=nv>$message</span><span class=p>);</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=k>class</span> <span class=nc>User</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=k>use</span> <span class=nx>InitializeTraits</span><span class=p>,</span> <span class=nx>RecordLog</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=nv>$user</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>User</span><span class=p>;</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>record</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>上述代码中，我们引入了 <code>RecordLog Trait</code> 来为 <code>User</code> 类添加记录日志的功能。同时，<code>RecordLog Trait</code> 通过定义 <code>initializeRecordLog</code> 方法来进行相关初始化。这种能力的实现原理依赖于 <code>InitializeTraits</code> 中的构造函数。但是，如果目标类本身已经存在构造函数，我们就需要进行特殊处理，以防止 <code>InitializeTraits</code> 中的构造函数被目标类中的构造函数所覆盖。</p><p>为了解决这个问题，我们可以在目标类中手动调用 <code>InitializeTraits</code> 中的构造函数，以确保所有的初始化逻辑都得到正确执行。例如，我们可以在目标类中做以下调整：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=k>class</span> <span class=nc>User</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=k>use</span> <span class=nx>InitializeTraits</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>        <span class=nx>__construct</span> <span class=k>as</span> <span class=nx>__traitConstruct</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=p>},</span> <span class=nx>RecordLog</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>__traitConstruct</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=baseservice>BaseService</h2><p><code>Better-Laravel</code> 中提供了 <code>Service</code> 层基类 <code>Yesccx\BetterLaravel\Service\BaseService</code>，其中引入了 <code>InstanceMake Trait</code>。</p><p>业务项目开发过程中，可以示情况进行继承使用。</p><h2 id=辅助方法>辅助方法</h2><h3 id=dumps>dumps</h3><p>类似 <code>Laravel</code> 中的 <code>dump</code> 方法，输出更精简的信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * dump wrapper
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> * PS: 自动对集合做toArray
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $vars
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return void
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=nf>dumps</span><span class=p>(</span><span class=nx>mixed</span> <span class=o>...</span><span class=nv>$vars</span><span class=p>)</span><span class=o>:</span> <span class=nx>void</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=dds>dds</h3><p>类似 <code>Laravel</code> 中的 <code>dd</code> 方法，输出更精简的信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * dd wrapper
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> * PS: 自动对集合做toArray
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $vars
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return void
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=nf>dds</span><span class=p>(</span><span class=nx>mixed</span> <span class=o>...</span><span class=nv>$vars</span><span class=p>)</span><span class=o>:</span> <span class=nx>void</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=explode_str_array>explode_str_array</h3><p>分割字符串数组</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 分割字符串数组
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param string $str
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param string $separator 分割符(默认,)
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return array
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=nf>explode_str_array</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$str</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$separator</span> <span class=o>=</span> <span class=s1>&#39;,&#39;</span><span class=p>)</span><span class=o>:</span> <span class=k>array</span><span class=p>;</span>
</span></span></code></pre></div><p>示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$arr</span> <span class=o>=</span> <span class=nx>explode_str_array</span><span class=p>(</span><span class=s1>&#39;a,b,c&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1>// [&#34;a&#34;, &#34;b&#34;, &#34;c&#34;]
</span></span></span></code></pre></div><h1 id=数据库>数据库</h1><h2 id=分页查询>分页查询</h2><p>在 <code>Laravel</code> 中，我们可以使用 <code>paginate</code>、<code>simplePaginate</code> 等方法进行分页查询。但是这些方法返回的结果包含了一些非必要的信息，并且其数据结构与常规的 <code>API</code> 响应结构不一致。</p><p>为了解决这些问题，我们可以使用 <code>Better-Laravel</code> 提供的分页方法：<code>customPaginate</code> 和 <code>customSimplePaginate</code>。这些方法的底层实现来自于 <code>Illuminate\Pagination\LengthAwarePaginator</code>，并最终由 <code>BuilderMarco</code> 扩展至 <code>Builder</code> 类上。这意味着您可以以模型链式调用的方式进行调用。</p><p>使用 <code>customPaginate</code> 和 <code>customSimplePaginate</code> 方法可以帮助我们更好地控制分页结果，并将其转换为符合常规 <code>API</code> 响应结构的格式。此外，这些方法还允许我们轻松自定义分页查询的参数，以满足不同场景下的需求。</p><blockquote><p>如果需要进行深度定制，比如重新定义分页输出结构，我们可以通过重写 <code>Yesccx\BetterLaravel\Database\CustomLengthAwarePaginator</code> 类的相关方法，并在 <code>better-laravel.binds</code> 配置文件中重新定义映射关系。</p></blockquote><h3 id=普通分页查询>普通分页查询</h3><p>如果想在 <code>Better-Laravel</code> 中进行普通分页查询，我们可以使用 <code>customPaginate</code> 方法。以下是一个示例参考：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$list</span> <span class=o>=</span> <span class=nx>User</span><span class=o>::</span><span class=na>query</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>customPaginate</span><span class=p>();</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln> 1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;操作成功&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>        <span class=nt>&#34;paginate&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>            <span class=nt>&#34;total&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>            <span class=nt>&#34;current_page&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>            <span class=nt>&#34;current_count&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>            <span class=nt>&#34;page_size&#34;</span><span class=p>:</span> <span class=mi>15</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=nt>&#34;list&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>                <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>                <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;张三&#34;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>默认情况下，<code>customPaginate</code> 方法会自动从请求中获取 <code>per_page</code> 作为每页数量参数，<code>page</code> 作为页码参数。如果将 <code>allowFetchAll</code> 参数设置为 <code>true</code>，则还会额外接收来自请求中的 <code>fetch_all</code> 参数，当 <code>fetch_all</code> 为 <code>true</code> 时，会获取满足条件的所有数据而不进行分页查询。这个功能在为前端提供类似“下拉框数据源接口”时非常有用。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=nv>$list</span> <span class=o>=</span> <span class=nx>User</span><span class=o>::</span><span class=na>query</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>customPaginate</span><span class=p>(</span><span class=k>true</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1>// http://localhost/api/user/list?fetch_all=1
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>// {
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1>//     &#34;message&#34;: &#34;操作成功&#34;,
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1>//     &#34;code&#34;: 200,
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1>//     &#34;data&#34;: {
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>//         &#34;list&#34;: [
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1>//             {
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1>//                 &#34;id&#34;: 1,
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1>//                 &#34;name&#34;: &#34;张三&#34;
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1>//             },
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1>//             ....
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1>//         ]
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1>//     }
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1>// http://localhost/api/user/list
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=c1>// {
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1>//     &#34;message&#34;: &#34;操作成功&#34;,
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=c1>//     &#34;code&#34;: 200,
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1>//     &#34;data&#34;: {
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1>//         &#34;paginate&#34;: {
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1>//             &#34;total&#34;: 0,
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1>//             &#34;current_page&#34;: 1,
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=c1>//             &#34;current_count&#34;: 0,
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1>//             &#34;page_size&#34;: 15
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1>//         },
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=c1>//         &#34;list&#34;: [
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=c1>//             {
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=c1>//                 &#34;id&#34;: 1,
</span></span></span><span class=line><span class=ln>32</span><span class=cl><span class=c1>//                 &#34;name&#34;: &#34;张三&#34;
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=c1>//             },
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=c1>//             ....
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=c1>//         ]
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=c1>//     }
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><p>通过上述代码的实现，我们只需要提供一个 <code>user/list</code> 接口，即可既满足用户列表的分页展示，也满足前端需要查看并选择所有用户的场景。这样可以避免出现重复的接口，提高接口的复用性和可维护性。</p><blockquote><p>！！需要注意的是，在实际开发中，为了避免影响数据库性能和接口响应速度，我们需要更具体地限制这种查询能力的使用。尤其是在数据量大的情况下，如果滥用这个功能将会给数据库带来极大的压力；</p></blockquote><p>当我们需要自定义 <code>per_page</code> 和 <code>page</code> 参数值时，可以手动将这些参数传入 <code>customPaginate</code> 方法。此时方法会使用手动传入的参数值来进行分页查询，而覆盖默认从请求中获取参数的行为；</p><p>更多参数配置参考下面的方法签名：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 自定义分页
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param bool $allowFetchAll 是否允许获取全部
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param null|int $perPage 每页数量
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param null|int $page 页码
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @param bool $forceFetchAll 是否强制获取全部
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @param array $options 扩展选项 @see PaginatorOptions::data
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> * @return CustomLengthAwarePaginatorContract
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>function</span> <span class=p>(</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$allowFetchAll</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=o>?</span><span class=nx>int</span> <span class=nv>$perPage</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=o>?</span><span class=nx>int</span> <span class=nv>$page</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$forceFetchAll</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>array</span> <span class=nv>$options</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>CustomLengthAwarePaginatorContract</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=简单分页查询>简单分页查询</h3><p>与 <code>Laravel</code> 中的 <code>simplePaginate</code> 方法对应，<code>Better-Laravel</code> 中也提供了简单分页查询方法 <code>customSimplePaginate</code>，该方法与 <code>customPaginate</code> 的用法和原理非常相似。</p><p>更多参数配置参考下面的方法签名：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 自定义简单分页
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param bool $allowFetchAll 是否允许获取全部
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param null|int $perPage 每页数量
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param null|int $page 页码
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @param bool $forceFetchAll 是否强制获取全部
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @param array $options 扩展选项 @see PaginatorOptions::data
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> * @return CustomPaginatorContract
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>function</span> <span class=p>(</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$allowFetchAll</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=o>?</span><span class=nx>int</span> <span class=nv>$perPage</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=o>?</span><span class=nx>int</span> <span class=nv>$page</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$forceFetchAll</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>array</span> <span class=nv>$options</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>CustomPaginatorContract</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=自定义分页数据>自定义分页数据</h3><p>当我们需要用自己的数据进行分页时，可以使用 <code>CustomLengthAwarePaginator</code> 分页器来生成标准分页器对象。这个分页器提供了一个静态方法 <code>resolve</code>，用法与 <code>customPaginate</code> 方法类似，同样的也可以手动传入 <code>per_page</code> 、<code>page</code> 、<code>fetch_all</code> 等参数，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$list</span> <span class=o>=</span> <span class=nx>\Yesccx\BetterLaravel\Database\CustomLengthAwarePaginator</span><span class=o>::</span><span class=na>resolve</span><span class=p>(</span><span class=nx>items</span><span class=o>:</span> <span class=p>[],</span> <span class=nx>total</span><span class=o>:</span> <span class=mi>30</span><span class=p>,</span> <span class=nx>perPage</span><span class=o>:</span> <span class=mi>15</span><span class=p>,</span> <span class=nx>page</span><span class=o>:</span> <span class=mi>1</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=空分页>空分页</h3><p>有时候我们需要构造一个空的分页对象，比如在某些特定场景下，如果接口返回空数据或者查询结果为空，我们需要构造一个空的分页器对象来给前端展示，这时可以使用 <code>CustomLengthAwarePaginator</code> 分页器中的静态方法 <code>toEmpty</code> 来构造一个不进行实际查询的空分页对象。示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$list</span> <span class=o>=</span> <span class=nx>\Yesccx\BetterLaravel\Database\CustomLengthAwarePaginator</span><span class=o>::</span><span class=na>toEmpty</span><span class=p>();</span>
</span></span></code></pre></div><h2 id=builder查询>Builder查询</h2><p><code>Better-Laravel</code> 中为 <code>Builder</code> 类扩展了更多的查询方法，这些方法都是通过 <code>marco</code> 进行扩展，因此也支持查询方法链式调用，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=c1>// 通过模型类，查询注册时间是当日的用户
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1></span><span class=nx>User</span><span class=o>::</span><span class=na>query</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>whereToday</span><span class=p>(</span><span class=s1>&#39;register_time&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>first</span><span class=p>();</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1>// 通过DB类，查询注册时间是当日的用户
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=c1></span><span class=nx>DB</span><span class=o>::</span><span class=na>table</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>whereToday</span><span class=p>(</span><span class=s1>&#39;register_time&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>first</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=custompaginate>customPaginate</h3><p>自定义分页</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 自定义分页
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param bool $allowFetchAll 是否允许获取全部
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param null|int $perPage 每页数量
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param null|int $page 页码
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @param bool $forceFetchAll 是否强制获取全部
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @param array $options 扩展选项 @see PaginatorOptions::data
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> * @return CustomLengthAwarePaginatorContract
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>function</span> <span class=p>(</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$allowFetchAll</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=o>?</span><span class=nx>int</span> <span class=nv>$perPage</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=o>?</span><span class=nx>int</span> <span class=nv>$page</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$forceFetchAll</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>array</span> <span class=nv>$options</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>CustomLengthAwarePaginatorContract</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=customsimplepaginate>customSimplePaginate</h3><p>自定义简单分页</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 自定义简单分页
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param bool $allowFetchAll 是否允许获取全部
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param null|int $perPage 每页数量
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param null|int $page 页码
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @param bool $forceFetchAll 是否强制获取全部
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @param array $options 扩展选项 @see PaginatorOptions::data
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> * @return CustomPaginatorContract
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>function</span> <span class=p>(</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$allowFetchAll</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=o>?</span><span class=nx>int</span> <span class=nv>$perPage</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=o>?</span><span class=nx>int</span> <span class=nv>$page</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$forceFetchAll</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>array</span> <span class=nv>$options</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>CustomPaginatorContract</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wherelike>whereLike</h3><p>LIKE查询</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * LIKE查询
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param mixed $fields 查询字段
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param mixed $keywords 查询值
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param int $mode 0-all;1-start;2-end;3-normal
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$fields</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$keywords</span><span class=p>,</span> <span class=nx>int</span> <span class=nv>$mode</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=whenlike>whenLike</h3><p>(when)LIKE查询</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * (when)LIKE查询
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param mixed $fields 查询字段
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param mixed $keywords 查询值
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param int $mode 0-all 1-start 2-end 3-normal
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$fields</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$keywords</span><span class=p>,</span> <span class=nx>int</span> <span class=nv>$mode</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wheretoday>whereToday</h3><p>查询是否为当日</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 查询是否为当日
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @uses whereThisDay()
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wherethisday>whereThisDay</h3><p>查询是否为当日，为 <a href=#whereToday>whereToday</a> 的别名方法</p><h3 id=whereinday>whereInDay</h3><p>查询是否为某日</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否为某日
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $month 日期 2022-01-01
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$day</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wherethisweek>whereThisWeek</h3><p>查询是否为本周</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否为本周
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wherethismonth>whereThisMonth</h3><p>查询是否为本月</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否为本月
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=whereinmonth>whereInMonth</h3><p>查询是否为某月</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否为某月
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $month 月份 2022-01
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$month</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wherethisyear>whereThisYear</h3><p>查询是否为本年</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否为本年
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=whereinyear>whereInYear</h3><p>查询是否为某年</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否为某年
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $year 年份 2022
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$year</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wheregtdate>whereGtDate</h3><p>查询是否大于指定日期</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否大于指定日期
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $date 日期(默认为当前时间)
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$date</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wheregtedate>whereGteDate</h3><p>查询是否大于等于指定日期</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否大于等于指定日期
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $date 日期(默认为当前时间)
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$date</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=whereltdate>whereLtDate</h3><p>查询是否小于指定日期</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否小于指定日期
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $date 日期(默认为当前时间)
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$date</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=whereltedate>whereLteDate</h3><p>查询是否小于等于指定日期</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 查询是否小于等于指定日期
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param mixed $date 日期(默认为当前时间)
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>mixed</span> <span class=nv>$field</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$date</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=wherebetweendate>whereBetweenDate</h3><p>查询是在指定日期范围内</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 查询是在指定日期范围内
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param mixed $field 查询字段
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param mixed $startDate 开始日期
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param mixed $endDate 结束日期
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @param bool $forceFullDay 是否为强制全天
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> * @return Builder
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$field</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$startDate</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span> <span class=nx>mixed</span> <span class=nv>$endDate</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span> <span class=nx>bool</span> <span class=nv>$forceFullDay</span> <span class=o>=</span> <span class=k>false</span><span class=p>)</span><span class=o>:</span> <span class=nx>Builder</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=非严格格式查询>非严格格式查询</h3><p>默认情况下 <code>Laravel</code> 中的 <code>mysql</code> 连接配置启用了严格模式，此时会限制查询语句的执行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nx>User</span><span class=o>::</span><span class=na>query</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>select</span><span class=p>([</span><span class=s1>&#39;id&#39;</span><span class=p>])</span><span class=o>-&gt;</span><span class=na>groupBy</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>first</span><span class=p>();</span>
</span></span></code></pre></div><p>例如执行上述查询时，由于在 <code>MYSQL</code> 严格模式下，<code>SELECT</code> 语句中的 <code>GROUP BY</code> 子句与 <code>SELECT</code> 子句中的字段不一致时，会抛出错误，所以我们可以通过临时开启非严格模式进行查询。</p><p>首先在需要进行非严格模式查询的模型中引入 <code>\Yesccx\BetterLaravel\Database\Traits\UnStrictQuery</code>，再使用 <code>unStrictQuery</code> 方法进行查询操作：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nx>User</span><span class=o>::</span><span class=na>unStrictQuery</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>select</span><span class=p>([</span><span class=s1>&#39;id&#39;</span><span class=p>])</span><span class=o>-&gt;</span><span class=na>groupBy</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>first</span><span class=p>();</span>
</span></span></code></pre></div><blockquote><p>!!! 注意目前只能以这种方式对模型进行非严格模式查询，不支持在事务中进行非严格模式更新操作。</p></blockquote><h1 id=http>HTTP</h1><h2 id=请求响应responser>请求响应(Responser)</h2><p>针对常见的接口开发场景，封装了快速响应 <code>成功</code>、<code>失败</code>、<code>异常</code>、<code>数据</code> 等方法，并统一了响应结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln>1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;响应成功&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>默认情况下响应体中的 响应码(code)为 <code>200</code> 或 <code>404</code> ，响应文案(message)为 <code>操作成功</code> 或 <code>操作失败</code> ，可以通过 <code>better-laravel.http.message_body_map</code> 重定义：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=s1>&#39;http&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>        <span class=s1>&#39;message_body_map&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>            <span class=nx>\Yesccx\BetterLaravel\Http\Supports\ResponseCode</span><span class=o>::</span><span class=na>SUCCESS_CODE</span>    <span class=o>=&gt;</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>            <span class=nx>\Yesccx\BetterLaravel\Http\Supports\ResponseCode</span><span class=o>::</span><span class=na>ERROR_CODE</span>      <span class=o>=&gt;</span> <span class=mi>400403</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>            <span class=nx>\Yesccx\BetterLaravel\Http\Supports\ResponseCode</span><span class=o>::</span><span class=na>SUCCESS_MESSAGE</span> <span class=o>=&gt;</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>            <span class=nx>\Yesccx\BetterLaravel\Http\Supports\ResponseCode</span><span class=o>::</span><span class=na>ERROR_MESSAGE</span>   <span class=o>=&gt;</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span><span class=p>]</span>
</span></span></code></pre></div><blockquote><p>如果想调整默认响应结构或扩展其他功能，可以对 <code>\Yesccx\BetterLaravel\Http\Responder</code> 类进行重写，并在 <code>better-laravel.binds</code> 配置文件中重新定义映射关系。</p></blockquote><h3 id=responsesuccess>responseSuccess</h3><p>响应成功信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 响应成功信息
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param mixed $message 响应信息
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param mixed $data 响应数据
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param mixed $code 响应码
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @param array $headers 响应头
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @param int $options
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sd> * @return JsonResponse
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nx>responseSuccess</span><span class=p>(</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$message</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$data</span> <span class=o>=</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$code</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>array</span> <span class=nv>$headers</span> <span class=o>=</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=nx>int</span> <span class=nv>$options</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>JsonResponse</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=responseerror>responseError</h3><p>响应失败信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 响应失败信息
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param mixed $message 响应信息
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param mixed $code 响应码
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param mixed $data 响应数据
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @param array $headers 响应头
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @param int $options
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sd> * @return JsonResponse
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nx>responseError</span><span class=p>(</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$message</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$code</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$data</span> <span class=o>=</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>array</span> <span class=nv>$headers</span> <span class=o>=</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=nx>int</span> <span class=nv>$options</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>JsonResponse</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=responsedata>responseData</h3><p>响应数据信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 响应数据信息
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param mixed $data 响应数据
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param string|bool $resource 是否使用资源类
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param mixed $message 响应信息
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @param bool $isCollection 是否按集合处理，默认根据响应数据类型判断
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @param mixed $code 响应码
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> * @param array $headers 响应头
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=sd> * @param int $options
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=sd> * @return JsonResponse
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nx>responseData</span><span class=p>(</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$data</span> <span class=o>=</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=nx>string</span><span class=o>|</span><span class=nx>bool</span> <span class=nv>$resource</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$message</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=nx>bool</span> <span class=nv>$isCollection</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=nx>mixed</span> <span class=nv>$code</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=k>array</span> <span class=nv>$headers</span> <span class=o>=</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=nx>int</span> <span class=nv>$options</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>JsonResponse</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=responseexception>responseException</h3><p>响应异常信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * 响应异常信息
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @param \Throwable $e
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> * @param array $options
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=sd> * @return JsonResponse
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>responseException</span><span class=p>(</span><span class=nx>\Throwable</span> <span class=nv>$e</span><span class=p>,</span> <span class=k>array</span> <span class=nv>$options</span> <span class=o>=</span> <span class=p>[])</span><span class=o>:</span> <span class=nx>JsonResponse</span><span class=p>;</span>
</span></span></code></pre></div><h2 id=控制器基类>控制器基类</h2><p>控制器是 <code>Laravel</code> 中的核心组件之一，其在 <code>HTTP</code> 请求处理过程中扮演着至关重要的角色。控制器通常需要接收请求参数、执行相应的逻辑并将结果返回给客户端。为了更好地实现快速接口开发，我们可以利用 <code>Better-Laravel</code> 中的控制器基类 <code>Yesccx\BetterLaravel\Http\BaseController</code>。</p><p><code>Yesccx\BetterLaravel\Http\BaseController</code> 基类封装了诸多常用的功能方法，包括：</p><ul><li><code>快速响应数据</code>：提供了 <code>responseSuccess</code>、<code>responseError</code> 和 <code>responseData</code> 等方法，可以方便地进行标准化的响应操作；</li><li><code>入参类型转换</code>：提供了 <code>fetch</code>、<code>fetchAll</code> 等方法，可以在获取参数的同时进行类型转换。</li></ul><p>使用 <code>Yesccx\BetterLaravel\Http\BaseController</code> 基类能够有效地提高代码可读性和可维护性，同时也可以简化接口开发的过程。</p><h3 id=接口响应response>接口响应(Response)</h3><p>当业务控制器继承基类 <code>Yesccx\BetterLaravel\Http\BaseController</code> 后，可以直接调用由 <a href=#%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94(Responser)><code>Responser</code></a> 提供的相关方法，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>declare</span><span class=p>(</span><span class=nx>strict_types</span> <span class=o>=</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>use</span> <span class=nx>Yesccx\BetterLaravel\Http\BaseController</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=k>use</span> <span class=nx>App\Models\User</span><span class=p>;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>final</span> <span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>BaseController</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>info</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span><span class=o>:</span> <span class=nx>\Illuminate\Http\JsonResponse</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$id</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>            <span class=c1>// 响应失败信息
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>responseError</span><span class=p>(</span><span class=s1>&#39;参数错误&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=nv>$user</span> <span class=o>=</span> <span class=nx>User</span><span class=o>::</span><span class=na>query</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>(</span><span class=nv>$id</span><span class=p>);</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$user</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>            <span class=c1>// 响应成功信息
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>responseSuccess</span><span class=p>(</span><span class=s1>&#39;用户暂未注册&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=c1>// 响应数据
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>responseData</span><span class=p>(</span><span class=nv>$user</span><span class=p>);</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>如果响应的数据还需要经过 <code>Resource</code> 处理，我们可以直接将 <code>Resource</code> 类及数据传递给 <code>responseData</code> 方法，这样做可以在响应数据之前进行进一步的加工和处理，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>responseData</span><span class=p>(</span><span class=nv>$user</span><span class=p>,</span> <span class=nx>UserResource</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></div><p>当响应的数据是二维数组或者集合时，我们可以通过额外的参数决定以 <code>资源集合</code> 的方式进行处理，但当数据由分页器查询返回时，可以不需要手动指定，<code>responseData</code> 方法内部会自动识别并以 <code>资源集合</code> 的方式进行处理。示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>responseData</span><span class=p>(</span><span class=nv>$userList</span><span class=p>,</span> <span class=nx>UserResource</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nx>isCollection</span><span class=o>:</span> <span class=k>true</span><span class=p>);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1>// 分页查询的结果不需要额外声明isCollection
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1></span><span class=nv>$userList</span> <span class=o>=</span> <span class=nx>User</span><span class=o>::</span><span class=na>query</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>customPaginate</span><span class=p>();</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>responseData</span><span class=p>(</span><span class=nv>$userList</span><span class=p>,</span> <span class=nx>UserResource</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=入参类型转换typetransfrom>入参类型转换(TypeTransfrom)</h3><p>通常我们在定义方法时都会声明其参数类型，所以往往我们在获取到 <code>Http</code> 请求参数后，都会显式的对其进行类型转换，以符合相关方法的调用要求。在 <code>Laravel</code> 中，我们可以通过 <code>Request</code> 类的 <code>get</code>、<code>input</code> 等方法获取入参，并手动将其转换为指定类型，如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$userid</span> <span class=o>=</span> <span class=p>(</span><span class=nx>int</span><span class=p>)</span> <span class=nx>request</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;userid&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nv>$phone</span> <span class=o>=</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span> <span class=nx>request</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;phone&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p><code>Better-Laravel</code> 中提供了获取参数并转换其类型的简写方式，通过 <code>fetch</code> 方法我们可以轻松的获取转换后的参数，同时也支持传入默认值，示例如下:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$userid</span> <span class=o>=</span> <span class=nx>request</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>(</span><span class=s1>&#39;user_id/d&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nv>$phone</span> <span class=o>=</span> <span class=nx>request</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>(</span><span class=s1>&#39;phone/s&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>默认情况下，<code>fetch</code> 方法会通过 <code>request()->all()</code> 获取作为数据源。但是，如果我们已经有了处理好的数据源，也可以通过 <code>fetch</code> 方法的第三个参数来传入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$userid</span> <span class=o>=</span> <span class=nx>request</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>(</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=s1>&#39;user_id/d&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=p>[</span><span class=s1>&#39;userid&#39;</span> <span class=o>=&gt;</span> <span class=mi>123</span><span class=p>]</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p>同时还支持通过 <code>fetchMany</code> 方法进行批量获取：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=nv>$data</span> <span class=o>=</span> <span class=nx>request</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>fetchMany</span><span class=p>([</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=s1>&#39;user_id/d&#39;</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=s1>&#39;phone/s&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>
</span></span><span class=line><span class=ln>5</span><span class=cl>    <span class=c1>// 不指定默认值时，默认为null
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=c1></span>    <span class=s1>&#39;summary/s&#39;</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=p>]);</span>
</span></span></code></pre></div><blockquote><p>也允许通过第2个参数自定义数据源。</p></blockquote><p>支持的类型及简写说明参考如下：</p><div class=table-wrapper><table><thead><tr><th>类型</th><th>语法</th></tr></thead><tbody><tr><td>数组</td><td>(a)array</td></tr><tr><td>数值</td><td>(n)number</td></tr><tr><td>整数</td><td>(i)int</td></tr><tr><td>浮点数</td><td>(f)float</td></tr><tr><td>布尔</td><td>(b)bool</td></tr><tr><td>字符串</td><td>(s)string</td></tr><tr><td>JSON</td><td>(j)json</td></tr></tbody></table></div><h2 id=表单验证>表单验证</h2><p><code>Laravel</code> 提供了多种验证传入应用程序的数据的方法。为确保安全性和规范性，建议为每个需要验证入参的接口创建表单验证类。</p><h3 id=表单验证基类>表单验证基类</h3><p>基于常见的开发场景，<code>Better-Laravel</code> 中已经准备好了表单验证基类 <code>Yesccx\BetterLaravel\Validation\BaseRequest</code>，用于快速创建可用的表单验证类。该基类默认开启了 <code>stopOnFirstFailure</code> 选项，表示在验证器验证的过程中遇到第一个规则失败时即停止，同时将表单请求授权验证 <code>authorize</code> 默认为通过。此外，还可以使用 <code>fetch</code> 或 <code>fetchMany</code> 方法，从验证通过的数据中获取并转换数据类型，这种能力继承自 <code>Request</code>。</p><p>以下示例通过继承基类 <code>BaseRequest</code> 定义业务验证类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>final</span> <span class=k>class</span> <span class=nc>AccountLoginRequest</span> <span class=k>extends</span> <span class=nx>BaseRequest</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd>     * Get custom attributes for validator errors.
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd>     * @return array
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>attributes</span><span class=p>()</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>            <span class=s1>&#39;username&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;用户名&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>            <span class=s1>&#39;password&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;密码&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=sd>     * Get the validation rules that apply to the request.
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=sd>     * @return array
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>rules</span><span class=p>()</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>            <span class=s1>&#39;username&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;bail&#39;</span><span class=p>,</span> <span class=s1>&#39;required&#39;</span><span class=p>,</span> <span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=s1>&#39;min:1&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>            <span class=s1>&#39;password&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;bail&#39;</span><span class=p>,</span> <span class=s1>&#39;required&#39;</span><span class=p>,</span> <span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=s1>&#39;min:1&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>login</span><span class=p>(</span><span class=nx>AccountLoginRequest</span> <span class=nv>$request</span><span class=p>)</span>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>fetchMan</span><span class=p>([</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>        <span class=s1>&#39;username/s&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>        <span class=s1>&#39;password/s&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>    <span class=p>]);</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>
</span></span><span class=line><span class=ln>39</span><span class=cl>    <span class=c1>// Do something ...
</span></span></span><span class=line><span class=ln>40</span><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=验证场景>验证场景</h3><p>为了减少验证规则类的重复定义，提高利用性，我们可以在表单验证类中定义验证场景。通过验证场景我们只需要在同一个验证类中定义好所有字段验证规则，再针对不同场景制定不同的验证字段。</p><p>首先我们需要定义一个验证类，继承 <code>Yesccx\BetterLaravel\Validation\BaseRequest</code> 基类并引入 <code>Yesccx\BetterLaravel\Validation\Traits\ValidatorScenes</code>，再在验证类中定义验证场景方法 <code>scenes</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>use</span> <span class=nx>Yesccx\BetterLaravel\Validation\BaseRequest</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=k>use</span> <span class=nx>Yesccx\BetterLaravel\Validation\Traits\ValidatorScenes</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>final</span> <span class=k>class</span> <span class=nc>UserRequest</span> <span class=k>extends</span> <span class=nx>BaseRequest</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=k>use</span> <span class=nx>ValidatorScenes</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=sd>     * 验证场景
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=sd>     * @return array
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>scenes</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>            <span class=s1>&#39;create&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>                <span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=s1>&#39;password&#39;</span><span class=p>,</span> <span class=s1>&#39;nickname&#39;</span><span class=p>,</span> <span class=s1>&#39;introduction&#39;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>            <span class=s1>&#39;update&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                <span class=s1>&#39;nickname&#39;</span><span class=p>,</span> <span class=s1>&#39;introduction&#39;</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=sd>     * Get custom attributes for validator errors.
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=sd>     * @return array
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>attributes</span><span class=p>()</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>            <span class=s1>&#39;username&#39;</span>      <span class=o>=&gt;</span> <span class=s1>&#39;用户名&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>            <span class=s1>&#39;password&#39;</span>      <span class=o>=&gt;</span> <span class=s1>&#39;密码&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>            <span class=s1>&#39;nickname&#39;</span>      <span class=o>=&gt;</span> <span class=s1>&#39;昵称&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>            <span class=s1>&#39;introduction&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;简介&#39;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>
</span></span><span class=line><span class=ln>42</span><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=ln>43</span><span class=cl><span class=sd>     * Get the validation rules that apply to the request.
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=sd>     * @return array
</span></span></span><span class=line><span class=ln>46</span><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>rules</span><span class=p>()</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>            <span class=s1>&#39;username&#39;</span>      <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;bail&#39;</span><span class=p>,</span> <span class=s1>&#39;required&#39;</span><span class=p>,</span> <span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=s1>&#39;min:1&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>            <span class=s1>&#39;password&#39;</span>      <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;bail&#39;</span><span class=p>,</span> <span class=s1>&#39;required&#39;</span><span class=p>,</span> <span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=s1>&#39;min:1&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>            <span class=s1>&#39;nickname&#39;</span>      <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;bail&#39;</span><span class=p>,</span> <span class=s1>&#39;nullable&#39;</span><span class=p>,</span> <span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=s1>&#39;min:1&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>            <span class=s1>&#39;introduction&#39;</span>  <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;bail&#39;</span><span class=p>,</span> <span class=s1>&#39;nullable&#39;</span><span class=p>,</span> <span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=s1>&#39;min:1&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>56</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在上述代码中，声明了两个验证场景 <code>create</code> 和 <code>update</code>。在请求进入控制器方法后，会识别当前控制器方法名作为当前场景名，并从验证类中找出对应验证场景的字段进行验证。示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>class</span> <span class=nc>UserController</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>create</span><span class=p>(</span><span class=nx>UserRequest</span> <span class=nv>$request</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=c1>// 此处会验证  &#39;username&#39;, &#39;password&#39;, &#39;nickname&#39;, &#39;introduction&#39; 字段
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>        <span class=c1>// Do something ...
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>update</span><span class=p>(</span><span class=nx>UserRequest</span> <span class=nv>$request</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>        <span class=c1>// 此处仅验证 &#39;nickname&#39;, &#39;introduction&#39; 字段
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span>        <span class=c1>// Do something ...
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>同时我们还可以为验证场景中的字段单独声明验证规则，这些规则将覆盖字段在 <code>rules</code> 中声明的规则：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * 验证场景
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @return array
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>scenes</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=s1>&#39;create&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>            <span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=s1>&#39;password&#39;</span><span class=p>,</span> <span class=s1>&#39;nickname&#39;</span><span class=p>,</span> <span class=s1>&#39;introduction&#39;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=s1>&#39;update&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>            <span class=c1>// 此处对 nickname 字段重新声明了验证规则
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span>            <span class=s1>&#39;nickname&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;bail&#39;</span><span class=p>,</span> <span class=s1>&#39;required&#39;</span><span class=p>,</span> <span class=s1>&#39;max:32&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>            <span class=s1>&#39;introduction&#39;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=验证规则>验证规则</h2><h3 id=arrayidsrule>ArrayIdsRule</h3><p>数组id集验证</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * @param bool $allowZero 值允许为0
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> * @param bool $allowNegativeNumber 值允许为负数
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param bool $allowFloatNumber 值允许浮点数
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param bool $allowRepeat 值允许重复
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> * @return void
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=k>protected</span> <span class=nx>bool</span> <span class=nv>$allowZero</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=k>protected</span> <span class=nx>bool</span> <span class=nv>$allowNegativeNumber</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=k>protected</span> <span class=nx>bool</span> <span class=nv>$allowFloatNumber</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=k>protected</span> <span class=nx>bool</span> <span class=nv>$allowRepeat</span> <span class=o>=</span> <span class=k>false</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=p>);</span>
</span></span></code></pre></div><h3 id=base64rule>Base64Rule</h3><p>base64验证</p><h3 id=idcardrule>IdCardRule</h3><p>身份证号验证</p><h3 id=landlinephonerule>LandlinePhoneRule</h3><p>固定电话验证</p><h3 id=phonerule>PhoneRule</h3><p>手机号验证</p><h3 id=stringarrayidsrule>StringArrayIdsRule</h3><p>字符串数组id集验证</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=sd> * @param string $separator 分隔符
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=sd> * @param bool $allowZero 值允许为0
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=sd> * @param bool $allowNegativeNumber 值允许为负数
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=sd> * @param bool $allowFloatNumber 值允许浮点数
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=sd> * @param bool $allowRepeat 值允许重复
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=sd> * @return void
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=k>protected</span> <span class=nx>string</span> <span class=nv>$separator</span> <span class=o>=</span> <span class=s1>&#39;,&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=k>protected</span> <span class=nx>bool</span> <span class=nv>$allowZero</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=k>protected</span> <span class=nx>bool</span> <span class=nv>$allowNegativeNumber</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=k>protected</span> <span class=nx>bool</span> <span class=nv>$allowFloatNumber</span> <span class=o>=</span> <span class=k>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=k>protected</span> <span class=nx>bool</span> <span class=nv>$allowRepeat</span> <span class=o>=</span> <span class=k>false</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=p>);</span>
</span></span></code></pre></div><h3 id=submanyrequestrule>SubManyRequestRule</h3><p>子表单集合验证</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * @param string $subRequest 子验证类
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @return void
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>    <span class=k>protected</span> <span class=nx>string</span> <span class=nv>$subRequest</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=p>);</span>
</span></span></code></pre></div><h3 id=subrequestrule>SubRequestRule</h3><p>子表单验证</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln>1</span><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=sd> * @param string $subRequest 子验证类
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=sd> * @return void
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>    <span class=k>protected</span> <span class=nx>string</span> <span class=nv>$subRequest</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=p>);</span>
</span></span></code></pre></div><h1 id=配置项>配置项</h1><p><code>Better-Laravel</code> 的配置文件为 <code>better-laravel.php</code>，其中包含了 <code>异常处理</code>、<code>类依赖关系</code>、<code>默认时间格式</code> 等配置项。</p><h2 id=date_format>date_format</h2><p>配置默认时间格式化，该格式将应用于以下内容：</p><ul><li><code>Carbon</code> 类的默认时间格式</li><li><code>Model</code> 中的默认时间输出格式</li></ul><h2 id=httproute_scanning>http.route_scanning</h2><p>定义 <code>模块路由</code> 的扫描文件夹，可以定义多个。同时支持通过 <code>options</code> 配置路由参数。</p><h2 id=httpmessage_body_map>http.message_body_map</h2><p>定义响应体中的默认响应码 <code>code</code> 与 默认响应文案 <code>message</code></p><p>待补充完善&mldr;</p><h1 id=使用建议>使用建议</h1><p>待补充完善&mldr;</p><h1 id=license>License</h1><p>MIT</p></section></article></main><footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://blog.yes-api.com/>Yesccx Blog</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Theme Paper</a></footer><script>window.onload=function(){document.querySelectorAll("body img").forEach(function(e,t){var s,o=e.parentElement,i="zoomCheck-"+t,n=document.createElement("input");n.setAttribute("type","checkbox"),n.setAttribute("hidden",""),n.setAttribute("id",i),s=document.createElement("label"),s.setAttribute("for",i),s.append(e),o.append(n),o.append(s)}),document.querySelectorAll("pre").forEach(function(e){e.dataset.lang=e.querySelector("code").dataset.lang}),document.querySelectorAll("section h1,h2,h3,h4,h5,h6").forEach(function(e){e.onclick=function(){window.location.hash=this.id}})}</script></body></html>